\documentclass[11pt,a4paper]{ivoa}
\input tthdefs
\usepackage{float}
\usepackage{todonotes}


\title{IVOA Relational Model for Spectral Lines and Protocol \(LineTAP\)}

% see ivoatexDoc for what group names to use here
\ivoagroup{???? group ????}

\author{Margarida Castro Neves, Nicolas Moreau}

\editor{Margarida Castro Neves, Nicolas Moreau}

% \previousversion[????URL????]{????Funny Label????}
\previousversion{This is the first public release}

\begin{document}
\begin{abstract}

This document proposes a set of  spectral line parameters that can be queried using the TAP protocol. Its purpose is to present a simpler way to query for spectral line data using VO Applications. Among the existing services, SSLDM/SLAP has very few services deployed and is not being used. On the other side, VAMDC is has plenty of services and spectral line information, but its data model is very complex. Therefore the need of a simpler model, using already established protocols for querying and retrieving the information. Besides the proposed set of parameters, a mapping from VAMDC data model has also been developed.

\end{abstract}


%\section*{Acknowledgments}


\section*{Conformance-related definitions}

The words ``MUST'', ``SHALL'', ``SHOULD'', ``MAY'', ``RECOMMENDED'', and
``OPTIONAL'' (in upper or lower case) used in this document are to be
interpreted as described in IETF standard RFC2119 \citep{std:RFC2119}.

The \emph{Virtual Observatory (VO)} is a
general term for a collection of federated resources that can be used
to conduct astronomical research, education, and outreach.
The \href{http://www.ivoa.net}{International
Virtual Observatory Alliance (IVOA)} is a global
collaboration of separately funded projects to develop standards and
infrastructure that enable VO applications.


\section{Introduction}

SLAP (Simple Line Access Protocol)\citep{2010ivoa.specQ1209O} is the VO standard for Spectral Line querying. SSLDM (Simple Spectral Line Access Protocol)\citep{2010ivoa.spec.1209O} is the VO data model for spectral lines.
Currently there are very few working services in the VO that use this protocols, meaning that the amount of spectral line data in the VO is small. 

On the other side, VAMDC services offer a great amount of spectral line data, and  so it's desirable to access this data in a VO-way. 
The queries to the VAMDC services might be simple, however, the data returned is much more than the necessary data for the common use cases in VO, besides the XSAMS \citep{XSAMS:Docs} output format being quite complex.

This document proposes a simple way to access spectral line data through a VO service through a relational data model. A selection of the relevant line quantities used in astronomy has been defined, which can be retrieved using TAP \citep{std:TAP}, which is an established IVOA protocol. It is restricted to atomic data, and could be expanded to include molecules in the future.

To make use of the VAMDC data, a mapping from the from the \href{https://standards.vamdc.eu/#data-model}{VAMDC-XSAMS Data Model} to the relational model is also presented. Using TAP, the resulting data is returned in VOTABLE format,  easily readable by VO client applications. 




\section{Use Cases}

In most use cases, the goal is to search for spectral lines within a wavelength range:

\todo{ more use cases}

\begin{itemize}

\item selecting  spectral lines that fit the ones in the spectrum.
Normally when searching for lines within a wavelength range, a great quantity of lines are returned, with very similar wavelengths. It's necessary to select the one that really represents the transition that caused the line in the spectrum.
\item areas: Stars, galaxies, ISM, planets?
\item calculating redshift
\item comparing theoretical spectra to observed spectra
\item classify the star type according to spectral lines?
\item spectral lines from a specific atom (or molecule)
\item spectral lines from a specific ionisation level
\item spectral lines with specific (other) parameter
\end{itemize}

Another use case to consider is to get a list of all available chemical species 
from a service, as a first step before looking for spectral lines.

For any retrieved spectral line, the reference of the source article where it was published
should always be provided if available.

\section{Protocol, Service discovery and queries - (need better title)}

\subsection{ Service description, service discovery }
\todo{ MARKUS D}

\subsection{ Queries: LineTAP }
\todo{ description, examples, translation VAMDC Queries}


\section{Spectral Line Data}\label{quantities}

We define the following atomic quantities based on IVOA use cases:

\todo{ method: define other method options besides experiment and theory?}

\begin{table}[H]
%\small
\begin{center}
\begin{tabular}{l l}% p{0.4\linewidth}}
\texttt{title} & the title of the line \\
\texttt{vacuum\_wavelength} & wavelength in vacuum, in Angstrom \\
\texttt{method} & method the wavelength was obtained with: \textit{Experiment}, \textit{Theory}  \\
\texttt{element\_symbol} & symbol describing the chemical element \\
\texttt{ion\_charge} & ionisation level\\
\texttt{atom\_mass\_number} & atom mass number\\
\texttt{upper\_state\_configuration} & upper state configuration\\
\texttt{lower\_state\_configuration} & lower state configuration\\
\texttt{upper\_energy} & energy of the upper state \\
\texttt{lower\_energy} & energy of the lower state\\
\texttt{inchi} & chemical species inchi \\
\texttt{inchikey} & chemical species inchikey \\
\texttt{einstein\_a} & Einstein A coefficient\\
\texttt{oscillator\_strength} & oscillator strength of radiative transition \\
\texttt{weighted\_oscillator\_strength} &  Weighted oscillator strength of radiative transition \\
\texttt{line\_strength} & Total absorption by a spectra line \\
\texttt{line\_reference\_doi} & Digital Object Identifier of bibliography source \\
\texttt{line\_reference\_uri} & Web link to the publication\\
\end{tabular}

\end{center}
\end{table}




%Returnables corresponding to a "DataType" in the XSAMS schema (numerical values) have additional categories, besides the value. Following categories will be also used in the mapping, \textit{Keyword} being the returnable keyword:

% \begin{itemize}
%\item \textit{Keyword}Unit  - the units of the value. If the wavelength unit returned is \textbf{A}, it must be corrected to \textbf{Angstrom} for compatibility
%\item \textit{Keyword}Method - the method used to obtain this value (e.g. experiment, theory, etc)
%\end{itemize}


\section{Mapping from VAMDCXSAMS}

The quantities used in the mapping belong to the following branches of VAMDCXSAMS:\\\\
\textit{XSAMSData.Species.Atoms.Atom}  referred as ATOM,\\
\textit{XSAMSData.Species.Atoms.AtomicState}  referred as ATOMICSTATE,\\
%\textit{XSAMSData.Species.Molecules.Molecule}, referred as MOLECULE,\\
\textit{XSAMSData.Processes.Radiative.RadiativeTransition}, referred as RADTRANS.\\

The VAMDC-TAP query language defines a list of keywords, called \href{https://standards.vamdc.eu/dictionary/returnables.html}{Returnables}, listing the quantities that can be returned by a service.They correspond to an element in the XSAMS data model. The returnables supported by a service are declared by a service manager when he deploys the software on its database, and saved in the VAMDC registry. \\

Listed below are the mappings for the atomic quantities defined in \ref{quantities} (at the moment only atoms, not molecules):


\renewcommand{\descriptionlabel}[1]{\hspace{\labelsep}\texttt{#1}}
\begin{description}

\item [vacuum\_wavelength] (in Angstrom)\hfill\\
    \textit{data model:} RADTRANS.EnergyWavelength\\
	\textit{returnables needed:} RadTransWavelength, RadTransWavelength.Vacuum, RadTransWavelengthAirToVac, RadTransWavelengthUnit\\
	\textit{constraints:} RadTransWavelengthVacuum = true; else use RadTransWavelengthAirToVac.\\
	
\item [method] \hfill\\
	\textit{data model:} Methods.Method.Category\\
	\textit{returnables needed:} RadTransWavelengthMethod\\
	\textit{constraints:} Methods.Method.MethodID=RadTransWavelength.Wavelength@methodRef\\

\item [inchi] \hfill\\
	\textit{data model:} ATOM.Isotope.Ion.InChi\\
        \textit{returnables needed:} AtomInchi\\
	\textit{constraints:} RadTrans.SpeciesRef = Atom.SpeciesID
	
\item [inchikey] \hfill\\
	\textit{data model:} ATOM.Isotope.Ion.InChiKey\\
         \textit{returnables needed:} AtomInchiKey\\
         \textit{constraints:} RadTrans.SpeciesRef = Atom.SpeciesID

\item [element\_symbol] \hfill\\
	\textit{data model:} ATOM.ChemicalElement.ElementSymbol\\
	\textit{returnables needed:} RadTrans.SpeciesRef, Atom.SpeciesID, Atom.Symbol
	\textit{constraints:}  RadTrans.SpeciesRef = Atom.SpeciesID

\item [ion\_charge]\hfill\\
	\textit{data model:} ATOM.Isotope.Ion.IonCharge\\
	\textit{returnables needed:} RadTransSpeciesRef, AtomSpeciesID, AtomIonCharge\\
	\textit{constraints:}RadTransSpeciesRef=AtomSpeciesID

	\item [atom\_mass\_number]\hfill\\
	\textit{data model:} ATOM.Isotope.IsotopParameters.MassNumber\\
	\textit{returnables needed:} AtomMassNumber\\
	\textit{constraints:}RadTransSpeciesRef=AtomSpeciesID

	\item [upper\_state\_configuration]\hfill\\
	\textit{data model:} ATOMICSTATE.Description\\
	\textit{returnables needed:} RadTransUpperStateRef, AtomStateID\\
	\textit{constraints:}  RadTransUpperStateRef = AtomStateID

	\item [lower\_state\_configuration]\hfill\\
	\textit{data model:} ATOMICSTATE.Description\\
	\textit{returnables needed:} RadTransLowerStateRef, AtomStateID\\
	\textit{constraints:}  RadTransLowerStateRef = AtomStateID

	\item [upperi\_state\_energy]\hfill\\
	\textit{data model:} ATOMICSTATE.AtomicNumericalData.StateEnergy\\
	\textit{returnables needed:} RadTransUpperStateRef, AtomStateID, AtomStateEnergyUnit\\
	\textit{constraints:}  RadTransUpperStateRef = AtomStateID
	
	\item [lower\_state\_energy]\hfill\\
	\textit{data model:} ATOMICSTATE.AtomicNumericalData.StateEnergy\\
	\textit{returnables needed:} RadTransLowerStateRef, AtomStateID, AtomStateEnergyUnit\\
	\textit{constraints:}  RadTransLowerStateRef = AtomStateID

	\item [einstein\_a]\hfill\\
	\textit{data model:}  RADTRANS.Probability.TransitionProbabilityA\\
	\textit{returnables needed:} RadTransProbabilityA\\
	\textit{constraints:}

	\item [oscillator\_strength]\hfill\\
	\textit{data model:}  RADTRANS.Probability.TransitionOscillatorStrength\\
	\textit{returnables needed:} RadTransProbabilityOscillatorStrength\\
        \textit{constraints:}

	\item [weighted\_oscillator\_strength]\hfill\\
	\textit{data model:}  RADTRANS.Probability.TransitionWeightedOscillatorStrength\\
	\textit{returnables needed:} RadTransProbabilityWeightedOscillatorStrength\\
 	   \textit{constraints:}

	\item [line\_reference\_doi]\hfill\\
	\textit{data model:} SOURCES.Source.DigitalObjectIdentifier\\
	\textit{returnables needed:} SourceDOI\\
	\textit{constraints:}

	\item [line\_reference\_uri]\hfill\\
	\textit{data model:} SOURCES.Source.UniformResourceIdentifier\\
	\textit{returnables needed:} SourceURI\\
	\textit{constraints:}

	\item [line\_strength]\hfill\\
	\textit{data model:} RadTrans.Probability.TransitionLineStrength\\
	\textit{returnables needed:} RadTransProbabilityLineStrength\\
        \textit{constraints:}

\item [title]\hfill\\
	a string composed by the values of  \texttt{element\_symbol} and \texttt{ion\_charge}


\end{description}


\appendix
\section{Changes from Previous Versions}

No previous versions yet.
% these would be subsections "Changes from v. WD-..."
% Use itemize environments.


\bibliography{ivoatex/ivoabib,ivoatex/docrepo, localrefs}

\end{document}